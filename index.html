<html>

<head>

	<meta charset="utf-8">
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="http://vk.com/js/api/openapi.js" type="text/javascript"></script>

	<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
	<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

	<style>
		body {
			background: url("bg.jpg") no-repeat;
			background-size: cover;
			background-attachment: fixed;
			overflow-y: scroll;
		}
		#navLayout {
			position: fixed;
			width: 100%;
		} 
		#avatar {
			width: 7vh;
			height: 7vh;
			background-color: #EF9A9A;
			border-radius: 50%;
			margin: 0;
			padding: 0;
			float: right;
			flex: flex;
			background-size: cover;
		}
		#HeaderName {
			color: #fff;
			font-size: 4.5vh;
			float: left;
			flex: auto;
		}
		#userName {
			color: #fff;
			font-size: 3vh;
			margin-right: 3vh;
			margin-left: 3vh;
		}
		#leftImg, #rightImg {
			background-color: #EF9A9A;
			border-radius: 50%;
			width: 90%;
			z-index: 100;
			position: relative;
			margin: 0 auto;
			transform: scale(1);
			transition: all .5s;
			background-size: cover;
			border: solid white;
			border-width: 50%;
		}
		#leftImg:hover, #rightImg:hover {
			transform: scale(1.03);
		}
		#navBar {
			padding-right: 8.3333333%;
			padding-left: 8.3333333%;
			padding-top: 3vh;
			padding-bottom: 1.14583333vh;
			display: flex;
			align-items: center;
		}
		#leftInfo, #rightInfo {
			background-color: white;
			position: relative;
			border-bottom-right-radius: 10%;
			border-bottom-left-radius: 10%;
			width: 50%;
			font-size: 1.4em;
			z-index: 0;
			margin: 0 auto;
			display: flex;
			justify-content: center;
			padding-bottom: 10px;
		}
		#cusButton {
			position: relative;
			background-color: red;
			border-radius: 5%;
			margin: 0 auto;
			width: 62.5%;
			display: flex;
			color: #fff;
			font-size: 1.4em;
			justify-content: center;
			align-items: center;
			transition: all .5s;
		}
		#cusButton:hover {
			background-color: #fff;
			color: #f00;
		}
		#slogan {
			width: 100%;
		}
		#choose, #themost, #worst {
			margin: 0 auto;
			color: white;
			text-align: center;
		}
		#choose{
			font-size: 2.8em;
		}
		#themost {
			font-size: 1em;
		}
		#worst {
			font-size: 2.6em;
		}
		.top-button {
			font-size: 2.5vh;
			margin-right: 5vh;
			color: #fff;
			display: inline-block;
		}
		.top-button:hover {
			color: #ffeb3b;
			text-decoration: none;		
		}
		.top-button:after {
			display: block;
			content: "";
			height: 0.3vh;
			width: 0%;
			background-color: #ffeb3b;
			transition: width .3s ease-in-out;
		}
		.top-button:hover:after,
		.top-button:focus:after {
			width: 100%;
		}
		#mainContent {
			padding-top: 11%;
		}
		#login-screen {
			display: none;
			font-family: 'Roboto', sans-serif;
			font-size: 2.5em;
			color: #757575;
			position: fixed;
			left: 0;
			top: 0;
			right: 0;
			bottom: 0;
			background: #FAFAFA;
			text-align: center;
			z-index: 100500;
		}
		#login-screen img {
			position:absolute;
			left:50%;
			top:50%;
			margin:-70px 0 0 -50px;
			width: 100px;
			height: 100px;
		}
		#login-screen div {
			margin-top: 10%;
		}
		#gRating {
			padding-top: 11%;
		}
		#rateCanvas {
			position: relative;
			z-index: 100;
			width: 100%;
			margin-top: 5%;
			background-color: #fff;
			border-top-left-radius: 3px;
			border-top-right-radius: 3px;
			text-align: center;
			/*overflow-y: scroll; */  
		}
		.rating-row {
			font-size: 2em;
			margin: 0 auto;
			float: left;
		}
		@media screen and (min-width: 1024px) {
			#rateCanvas {
				width: 85%;
				margin: 5% auto 0;
			}
		}
		ul {
			display: flex;
			align-items: center;
			list-style-type: none;
		}
		li {
			float:left;
		}
		@media screen and (max-width: 1024px) {

		}
	</style>

	<script type="text/javascript">
		VK.init({
			apiId: 5148155
		});
	</script>
</head>

<body>
	<div id="login-screen">
		<div>ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð²Ñ…Ð¾Ð´Ð°:</div>
		<img onClick="VK.Auth.login(authInfo);" src="vk.svg">
	</div>
<div id="navLayout">
	<div id="navBar">
		<b id="HeaderName"><img src="shock.svg" style="height:1.5em;">ShockRates</b>
		<ul>
		<li><span class="top-button" onclick="rateClick();">Rate</span></li>
		<li><span class="top-button" onclick="gRatingClick();">Global rating</span></li>
		<li><span class="top-button">Local rating</span></li>
		<li>
		<b id="userName">User Name</b></li><li>
		<div id="avatar" onclick="logOut();"></div>
		</li>
		</ul>
	</div>
	</div>

	<div class="container-fluid" id="mainContent">
		<div class="row" media="min-width:820px">
			<div class="col-md-1"></div>
			<div class="col-md-4">
				<div id="leftImg" onClick="chooseLeft();"></div>
				<div id="leftInfo">Top 1 huesos</div>
			</div>
			<div class="col-md-2">
				<div id="slogan">
					<div id="choose">Ð’Ñ‹Ð±ÐµÑ€Ð¸</div>
					<div id="themost">Ð¡ÐÐœÐžÐ“Ðž</div>
					<div id="worst">Ñ…ÑƒÐµÑÐ¾ÑÐ½Ð¾Ð³Ð¾</div>
				</div>
				<hr>
				<div id="cusButton">
					Button
				</div>
			</div>
			<div class="col-md-4">
				<div id="rightImg" onClick="chooseRight();"></div>
				<div id="rightInfo">Top 2 huesos</div>
			</div>
			<div class="col-md-1"></div>
		</div>
	</div>
	
	<div id="gRating">
		<div id="rateCanvas">
			<?php
			$hostname = "localhost";
			$username = "epesnya";
			$password = "qwerty123";
			$dbName = "testbd";

			$mysqli = new mysqli($hostname, $username, $password, $dbName);

			$cur_query = mysqli_query($mysqli, "SELECT * FROM users ORDER BY rating LIMIT 15");
			while ($selected_data = mysqli_fetch_assoc($cur_query)) {
			echo "<img src = \"".$selected_data['photo']."\"><div class=\"rating-row\">".$selected_data['first_name']." ".$selected_data['last_name']." ".$selected_data['rating']."</div>";
		}
		?>
	</div>
</div>


<script type="text/javascript">
	$('#gRating').hide();
	$('#leftImg').css("height", $('#leftImg').width() + 'px');
	$('#leftInfo').css("height", (0.7) * $('#leftImg').width() + 'px');
	$('#leftInfo').css("top", (-0.5) * $('#leftImg').width() + 'px');
	$('#leftInfo').css("padding-top", (0.55) * $('#leftImg').height() + 'px');
	$('#rightImg').css("height", $('#rightImg').width() + 'px');
	$('#rightInfo').css("height", (0.7) * $('#rightImg').width() + 'px');
	$('#rightInfo').css("top", (-0.5) * $('#rightImg').width() + 'px');
	$('#rightInfo').css("padding-top", (0.55) * $('#rightImg').height() + 'px');
	$('#cusButton').css("height", $('#cusButton').width() / 2.0 + 'px');
	$('.col-md-4').css("height", "0px");

	var guys = [];
	guys = $('.rating-row').toArray();
	for(var i = 0; i < guys.length; i++) {
		if(i < 3) {
					//$('.rating-row:eq(' + i + ')>img').css("border-radius", "50%");
					$('.rating-row:eq(' + i + ')').css("width", "33.333333%");
				} else if(i < 8) {
					$('.rating-row:eq(' + i + ')').css("width", "20%");
				} else {
					$('.rating-row:eq(' + i + ')').css("width", "14.2857142%");
				}
				$('.rating-row:eq(' + i + ')').css("height", '500px');
			}

			var vkid1;
			var vkid2;

			var generatePair = function(){ 
				VK.Api.call('friends.get', {user_id: userId}, function(r) { 
					if(r.response) { 
						VK.Api.call('users.get', {lang: 0, user_ids: r.response, fields: 'photo_200, photo_400_orig, domain'}, function(res) { 
							var id1 = Math.round(Math.random() * res.response.length); 
							var id2 = Math.round(Math.random() * res.response.length); 
							vkid1 = res.response[id1].uid;
							vkid2 = res.response[id2].uid;
							while(id2 == id1) id2 = Math.round(Math.random() * r.response.length); 
						/////////
						if (typeof res.response[id1].photo_400_orig != "undefined")
							$('#leftImg').css("backgroundImage", "url(" + res.response[id1].photo_400_orig + ")");
						else $('#leftImg').css("backgroundImage", "url(" + res.response[id1].photo_200 + ")");
						/////////
						if (typeof res.response[id2].photo_400_orig != "undefined")
							$('#rightImg').css("backgroundImage", "url(" + res.response[id2].photo_400_orig + ")"); 
						else 
							$('#rightImg').css("backgroundImage", "url(" + res.response[id2].photo_200 + ")");
						////////
						$('#leftInfo').text(res.response[id1].first_name + ' ' + res.response[id1].last_name); 
						$('#leftInfo').attr("href", "https://vk.com/" + res.response[id1].domain);
						$('#rightInfo').text(res.response[id2].first_name + ' ' + res.response[id2].last_name); 
						$('#rightInfo').attr("href", "https://vk.com/" + res.response[id2].domain);
					});
					} 
				});
			}

			var init = function(response) {
				userId = response.session.mid;
				VK.Api.call('users.get', {user_id: userId, fields: 'photo_50'}, function(r)
				{
					$('#avatar').css("backgroundImage", "url(" + r.response[0].photo_50 + ")");
					$('#userName').text(r.response[0].first_name + ' ' + r.response[0].last_name);
				});
				VK.Api.call('friends.get', {user_id: userId}, function(r) { 
					if(r.response) { 
						VK.Api.call('users.get', {lang: 0, user_ids: r.response, fields: 'photo_400_orig, domain'}, function(res) { 
							$.post("users.php", { resp: res.response }, function(data) {});
						});
					} 
				});	

			};

			function logOut() {
				VK.Auth.logout();
				$("#login-screen").show();
			}

			var userId;
			VK.Auth.getLoginStatus(function(response){
				if (response.session){
					init(response);
					generatePair();
				}
				else {
					$("#login-screen").show();
				}
			});

			function authInfo(response) {
				if (response.session) {
					init(response);
					$("#login-screen").hide();
				} else {
					alert('Unable to authorize');
				}
			}

			cusButton.onclick = generatePair;
			function gRatingClick() {
				$("#mainContent").hide();	
				$("#gRating").show();
			}
			function rateClick() {
				$("#mainContent").show();
				$("#gRating").hide();
			}
			function chooseLeft() {
				$.post("rate.php", { winner: vkid1, loser: vkid2 }, function(data) {}).fail(function() {
					alert( "error" );
				});
				generatePair();
			}
			function chooseRight() {
				$.post("rate.php", { winner: vkid2, loser: vkid1 }, function(data) {}).fail(function() {
					alert( "error" );
				});
				generatePair();
			}
		</script>
	</body>

	</html>		
