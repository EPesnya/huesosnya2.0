<!DOCTYPE html>

<html lang="en">

<head>

	<title>Huesosnya</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js"
	type="text/javascript"></script>
	<script src="http://vk.com/js/api/openapi.js" type="text/javascript"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script> 

	<link rel="import" href="bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
	<link rel="import" href="bower_components/paper-toolbar/paper-toolbar.html">
	<link rel="import" href="bower_components/iron-icons/iron-icons.html">
	<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
	<link rel="import" href="bower_components/paper-styles/color.html">
	<link rel="import" href="bower_components/paper-card/paper-card.html">
	<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
	<link rel="import" href="bower_components/paper-button/paper-button.html">
	<link rel="import" href="bower_components/paper-drawer-panel/paper-drawer-panel.html">
	<link rel="import" href="bower_components/paper-header-panel/paper-header-panel.html">
	<link rel="import" href="bower_components/paper-checkbox/paper-checkbox.html">


	<link rel="import" href="bower_components/paper-styles/demo.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Eczar:800" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Dosis:300" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Catamaran" rel="stylesheet">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


	<style is="custom-style">
		html {
			font-family: 'Catamaran', sans-serif;
		}
		body { 
			font-family: 'Catamaran'; 
			background-color: #f5cedb;
		}
		paper-drawer-panel {
			--paper-drawer-panel-main-container: {
				background: #fafafa;
			};
			--paper-drawer-panel-drawer-container:{
				border-right: 1px solid #e5e5e5;
			};
		}
		paper-toolbar {
			--paper-toolbar-background: #E91E63;
			font-size: 2em;
		}
		.drawer-content {
			position: relative;
		}
		.drawer-content paper-card {
			--paper-card:{
				width: 100%;
			};
			--paper-card-background-color: #90CAF9;
		}
		.drawer-content paper-card iron-image {
			margin: 12px 12px;
			width: 80px;
			height: 80px;
			border-radius: 80px;
			background-color: lightgray;
			float: left;
		}
		.drawer-content nav div {
			color: #424242;
		}
		.drawer-content nav div span {
			padding-left: 8px;
		}
		#leftHui {
			float: left;
		}
		#rightHui {
			float: right;
		}
		paper-scroll-header-panel {
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			background-color: var(--paper-grey-200, #eee);
			--paper-scroll-header-panel-full-header: {
				background-image: url(images/bg1.jpg);
				background-position: left center;
			};
			--paper-scroll-header-panel-condensed-header: {
				background-color: var(--paper-deep-purple-500);
			};
		}
		paper-icon-button {
			--paper-icon-button-ink-color: white;
		}
		paper-toolbar.tall {
			background-color: transparent;
		}
		paper-toolbar.tall .title {
			font-size: 40px;
			margin-left: 60px;
			-webkit-transform-origin: left center;
			transform-origin: left center;
		}
		.content {
			padding: 8px;
		}
		.spacer {
			@apply(--layout-flex);
		}
		.flex-horizontal-with-ratios {
			@apply(--layout-horizontal);
		}
		.flex-horizontal-with-ratios div iron-image{
			width: 200px;
			height: 200px;
			border-radius: 200px;
			background-color: lightgray;
		}
		.flexchild {
			@apply(--layout-flex-3);
		}
		.flex2child {
			@apply(--layout-flex-3);
		}
		.flex3child {
			@apply(--layout-flex-3);
		}
		#rightImg, #leftImg {
			height: 400px;
			width: 400px;
			border-radius: 200px;
			left: 0;
			opacity: 1;
			position: relative;
			-webkit-transition: left 1s ease-out 0.5s;
			-moz-transition: left 1s ease-out 0.5s;
			-o-transition: left 1s ease-out 0.5s;
			transition: left 1s ease-out 0.5s;
		}
		#userName {
			vertical-align: middle;
			font-family: 'Catamaran';
			font-size: 0.7em;
		}
		#userAvatar {
			border-radius: 50px;
			margin-right: 10px;
			margin-left: 10px; 
		}
		.col-xs-6 {
			text-align: center;
		}
		.row {
			text-align: center;
			padding-top: 16px;
		}
		#buttons {
			margin: auto 0 ;
		}
		#userInfo {
			width: 500px;
		}
		b {
			font-size: 54px;
		}
		paper-toolbar {
		}
		.flex-horizontal {
			@apply(--layout-horizontal);
		}
		.flexchild {
			@apply(--layout-flex);
		}
		.vertical-centred {
			@apply(--layout-self-center);
		}
		a {
			font-size: 20px;
			color: black;
			opacity: .87;
		}
		.menuLinks {
			font-size: 16px;
		}
		.moveLeft {
			opacity: 0.5;
			left: -100px;
		}
		#login-screen {
			display: none;
			font-family: 'Roboto', sans-serif;
			font-size: 2.5em;
			color: #757575;
			position: fixed;
			left: 0;
			top: 0;
			right: 0;
			bottom: 0;
			background: #FAFAFA;
			text-align: center;
			z-index: 100500;
		}
		#login-screen img {
			position:absolute;
			left:50%;
			top:50%;
			margin:-70px 0 0 -50px;
			width: 100px;
			height: 100px;
		}
		#login-screen div {
			margin-top: 10%;
		}
	</style>
	
	<script type="text/javascript">
		VK.init({
			apiId: 5148155
		});
	</script>

</head>


<body>

		<div id="login-screen">
			<div>Начните после входа:</div>
			<img onClick="VK.Auth.login(authInfo);" src="images/vk.svg">
		</div>

	<paper-toolbar>
		<div style="width: 100%;" class="container flex-horizontal">
			<div style="font-size: 36px;">Huesosnya</div>
			<div class="flexchild"></div>
			<div id="userInfo" class="container flex-horizontal">
				<div class="flexchild"></div>
				<div class="vertical-centred" id="userName"></div>
				<iron-image style="float: right;" id="userAvatar" preload></iron-image>
			</div>
		</div>	

	</paper-toolbar>

	<div style="text-align: center;" class="drawer-content"> 
	<!--
			<div>
				<iron-icon icon="icons:language"></iron-icon><span>Global rating</span>
				<iron-icon icon="icons:cached"></iron-icon><span>Local rating</span>
			</div>
			<hr>-->
			<div main id="main">
				<div class="container-fluid">
					<div class="row">
						<div id="buttons">
							<b style="line-height: 54px; font-family: 'Eczar';">Choose</b><br> 
							<b style="font-family: 'Catamaran'; font-size:16px; position: relative; top: -7px;">THE MOST</b><br>
							<b style="text-decoration: underline;font-size:42px; position: relative; top: -7px; line-height: 32px; font-family: 'Eczar';">husesosious</b>
						</div>
					</div>
				</div>
				<div class="row" style="position: relative; top: -30px;">
					<div class="col-md-5">
						<div class="flexchild"><iron-image onClick="chooseLeft()" id="leftImg" preload src=""></iron-image></div>
						<a id="leftName"></a>
					</div>
					<div style="height: 350px; position:relative; top: 16px;" class="col-md-2">
						<paper-button id="statusB" style="font-family: 'Catamaran'; margin-top:15px;background-color: #3f51b5; color: #fff;">Skip</paper-button><br>
						<div style="font-family: 'Catamaran'; margin-top:15px; margin-bottom:15px; text-align: left;">
							<paper-checkbox>Show ratings</paper-checkbox>
							<paper-checkbox>Rate people you may know</paper-checkbox>
						</div>
						<hr style="margin-bottom:15px;">

						<div style="font-family: 'Catamaran'; margin-top:15px; margin-bottom:15px; text-align: left;">
							<iron-icon icon="icons:language"></iron-icon><a class="menuLinks" href="#"> Global rating</a><br>
							<iron-icon icon="icons:cached"></iron-icon><a class="menuLinks" href="#"> Local rating</a>
						</div>
					</div>
					<div class="col-md-5">
						<div class="flex3child"><iron-image onClick="chooseRight()" id="rightImg" preload src=""></iron-image></div>
						<a id="rightName"></a>
					</div>
				</div>
			</div>
	</div>
	<script>
		var vkid1;
		var vkid2;
	    var title = document.querySelector('.title');
	    addEventListener('paper-header-transform', function(e) {
	    	var d = e.detail;
	    	var m = d.height - d.condensedHeight;
	    	var scale = Math.max(0.75, (m - d.y) / (m / 0.25)  + 0.75);
	    	Polymer.Base.transform('scale(' + scale + ') translateZ(0)', title);
	    });


		var generatePair = function(){ 
			VK.Api.call('friends.get', {user_id: userId}, function(r) { 
				if(r.response) { 
					VK.Api.call('users.get', {user_ids: r.response, fields: 'photo_400_orig, domain, photo_200'}, function(res) { 
						var id1 = Math.round(Math.random() * res.response.length); 
						var id2 = Math.round(Math.random() * res.response.length); 
						vkid1 = id1;
						vkid2 = id2;
						while(id2 == id1) id2 = Math.round(Math.random() * r.response.length); 
						$('#leftImg').addClass("moveLeft");
						if (res.response[id1].photo_400_orig)
						leftImg.src = res.response[id1].photo_400_orig;
						else leftImg.src = res.response[id1].photo_200;
						if (res.response[id1].photo_400_orig) 
						rightImg.src = res.response[id2].photo_400_orig; 
						else leftImg.src = res.response[id2].photo_200;
						$('#leftName').text(res.response[id1].first_name + ' ' + res.response[id1].last_name); 
						$('#leftName').attr("href", "https://vk.com/" + res.response[id1].domain);
						$('#rightName').text(res.response[id2].first_name + ' ' + res.response[id2].last_name); 
						$('#rightName').attr("href", "https://vk.com/" + res.response[id2].domain);
					});
				} 
			});
		}

		var init = function(response) {
			userId = response.session.mid;
			VK.Api.call('users.get', {user_id: userId, fields: 'photo_50'}, function(r)
			{
				userAvatar.src = r.response[0].photo_50;
				$('#userName').text(r.response[0].first_name + ' ' + r.response[0].last_name);
			});
			VK.Api.call('friends.get', {user_id: userId}, function(r) { 
				if(r.response) { 
					var s;
					for(var i = 0; i < r.response.length; i++) {
						s += r.response[i].uid + ',';
					}
					VK.Api.call('users.get', {user_ids: r.response, fields: 'photo_400_orig, domain'}, function(res) { 
						$.post("users.php", { resp: res.response }, function(data) {});
					});
				} 
			});	

		};

		var userId;
		VK.Auth.getLoginStatus(function(response){
			if (response.session){
				init(response);
			}
			else {
				$("#login-screen").show();
			}
		});
		function authInfo(response) {
			if (response.session) {
				init(response);
				$("#login-screen").hide();
			} else {
				alert('Unable to authorize');
			}
		}

	    statusB.onclick = generatePair;

	    function chooseLeft() {
	    	$.post("rate.php", { winner: vkid1, loser: vkid2 }, function(data) {});
	    	generatePair();
	    }
	    function chooseRight() {
	    	$.post("rate.php", { winner: vkid2, loser: vkid1 }, function(data) {});
	    	generatePair();
	    }
	</script>
</body>

</html>

